<!DOCTYPE html>
<html>
<head>
<title>test</title>
<style type="text/css">
body.noscroll {
    position: fixed;
    overflow-x: hidden;
    overflow-y: hidden;
    width: 100%;
}
</style>

<script type="text/javascript">
	var imgUrl, imgheight, imgwidth, uniqueId;

	function getMeta(url, callback) {
		var img = new Image();
		img.src = url;
		img.onload = function() { callback(this.width, this.height); }
	}

	function getQueryParam(param) {
		const urlParams = new URLSearchParams(window.location.search);
		return urlParams.get(param);
	}

	function fn() {
		// Get unique identifier for this iframe instance
		uniqueId = getQueryParam('id') || 'default'; // Fallback to 'default' if no ID is provided

		// Construct unique IDs
		const imageId = `myImage-${uniqueId}`;
		const linkId = `myLink-${uniqueId}`;
		const tdId = `myTd-${uniqueId}`;

		// Assign unique IDs dynamically
		document.getElementById('myImage').id = imageId;
		document.getElementById('myLink').id = linkId;
		document.getElementById('myTd').id = tdId;

		// Get parameters
		imgUrl = getQueryParam('img') || "https://difemaro.github.io/Resize/no_image.png";
		link = getQueryParam('link');
		target = getQueryParam('target');
		background = getQueryParam('color');

		if (link) {
			document.getElementById(linkId).href = link;
		}
		if (target && target === "new") {
			document.getElementById(linkId).target = "_blank";
		}
		if (background) {
			document.body.style.backgroundColor = background;
		}

		// Load image metadata and resize
		getMeta(imgUrl, function(width, height) {
			imgwidth = width;
			imgheight = height;

			let w = document.body.offsetWidth;
			let h = document.documentElement.offsetHeight;
			let h2 = document.body.offsetHeight;
			let h3 = window.innerHeight;

			if (h < h2) h = h2;
			if (h3 !== 'undefined' && h < h3) h = h3;

			document.getElementById(tdId).style.height = h + 'px';

			if (imgwidth / w <= imgheight / h) {
				w = imgwidth * h / imgheight;
			} else {
				h = imgheight * w / imgwidth;
			}

			const imageElement = document.getElementById(imageId);
			imageElement.src = imgUrl;
			imageElement.width = w;
			imageElement.height = h;
		});
	}

	window.onresize = function() {
		const imageId = `myImage-${uniqueId}`;
		const tdId = `myTd-${uniqueId}`;
		const imageElement = document.getElementById(imageId);

		if (!imageElement) return;

		let w = document.body.offsetWidth;
		let h = document.documentElement.offsetHeight;
		let h2 = document.body.offsetHeight;
		let h3 = window.innerHeight;

		if (h < h2) h = h2;
		if (h3 !== 'undefined' && h < h3) h = h3;

		document.getElementById(tdId).style.height = h + 'px';

		if (imgwidth / w <= imgheight / h) {
			w = imgwidth * h / imgheight;
		} else {
			h = imgheight * w / imgwidth;
		}

		imageElement.width = w;
		imageElement.height = h;
	};

</script>
</head>

<body onload="fn()" class="noscroll" style="margin:0px;background-color:white;">
	<table style="width:100%;border-spacing:0px">
		<tbody>
			<tr>
				<td id="myTd" style="text-align:center;padding:0px">
					<a id="myLink" target="_top" href="">
						<img src='' id="myImage" alt="Click to open image in new window"/>
					</a>
				</td>
			</tr>
		</tbody>
	</table>
</body>
</html>
